import{c as x,q as z,u as A,p as P,a as $,r as N,j as e,U as D,L as v,t as T,z as o}from"./index-D8XKaJer.js";import{P as k,D as F}from"./package-Mwv3Sw9P.js";const E=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],H=x("calendar",E);const J=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],U=x("circle-x",J);const V=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],I=x("log-out",V);const K=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],Q=x("shopping-bag",K),B=z.injectEndpoints({endpoints:a=>({getOrders:a.query({query:()=>"/order",providesTags:["Order"]}),cancelOrder:a.mutation({query:h=>({url:`/order/${h}/cancel`,method:"PATCH"}),invalidatesTags:["Order","Product"]})})}),{useGetOrdersQuery:G,useCancelOrderMutation:R}=B,g=a=>Math.round(Number(a||0)*100)/100,X=a=>Number.isInteger(g(a))?String(g(a)):g(a).toFixed(2),w=a=>g(a).toFixed(2);function Z(){const a=A(),h=P(),{user:l}=$(r=>r.auth),{data:u,isLoading:O,isError:j}=G(void 0,{skip:!l}),[S,{isLoading:_}]=R(),[y,c]=N.useState([]),[C,p]=N.useState(null);N.useEffect(()=>{if(!l){a("/login");return}if(u?.orders)c(u.orders);else if(j){console.warn("API failed, using local storage fallback.");const r=`orders_${l.username||l.email}`,m=JSON.parse(localStorage.getItem(r))||[];c(m)}},[u,j,l,a]);const L=()=>{h(T()),a("/login")},M=async r=>{if(!window.confirm("Are you sure you want to cancel this order?"))return;if(p(r),typeof r=="number"||!y.some(s=>s._id===r)){try{const s=`orders_${l?.email||l?.username}`,n=JSON.parse(localStorage.getItem(s))||[],d=Number(r);!Number.isNaN(d)&&d>=0&&d<n.length?(n.splice(d,1),localStorage.setItem(s,JSON.stringify(n)),c([...n]),o.success("Order cancelled successfully")):(c(t=>t.filter((i,f)=>f!==d)),o.success("Order cancelled successfully"))}catch(s){console.error(s),o.error("Failed to cancel local order")}finally{p(null)}return}try{await S(r).unwrap(),c(t=>t.filter(i=>i._id!==r));const s=`orders_${l?.email||l?.username}`,d=(JSON.parse(localStorage.getItem(s))||[]).filter(t=>t._id!==r);localStorage.setItem(s,JSON.stringify(d)),o.success("Order cancelled successfully")}catch(s){console.error(s),o.error(s.data?.message||"Failed to cancel order")}finally{p(null)}};if(!l)return null;const b=y.filter(r=>r?.status!=="canceled");return e.jsxs("div",{className:"max-w-6xl mx-auto mt-24 px-4 sm:px-6 lg:px-8 mb-20 w-full transition-colors duration-300",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1e1e1e] rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800 p-8 mb-8 flex flex-col md:flex-row items-center md:items-start justify-between gap-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-green-500/10 rounded-full blur-3xl -z-10 translate-x-1/2 -translate-y-1/2"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6 z-10",children:[e.jsx("div",{className:"w-28 h-28 bg-gradient-to-br from-green-400 to-green-600 text-white rounded-full flex items-center justify-center shadow-lg border-4 border-white dark:border-gray-800 shrink-0",children:e.jsx(D,{className:"w-14 h-14"})}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h2",{className:"text-3xl font-black text-gray-900 dark:text-white mb-1 tracking-tight",children:l.name||l.username||"Valued Customer"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium mb-2",children:l.email}),e.jsxs("div",{className:"inline-flex items-center gap-2 bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full text-sm font-semibold text-gray-700 dark:text-gray-300",children:[e.jsx(Q,{className:"w-4 h-4 text-green-600"}),b.length," Active Orders"]})]})]}),e.jsxs("button",{onClick:L,className:"z-10 inline-flex items-center gap-2 px-6 py-3 bg-red-50 dark:bg-red-900/20 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/40 rounded-xl font-bold transition-all active:scale-95",children:[e.jsx(I,{className:"w-5 h-5"}),"Sign Out"]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1e1e1e] rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800 p-6 md:p-10 min-h-[500px]",children:[e.jsx("div",{className:"flex items-center justify-between mb-8 pb-6 border-b border-gray-100 dark:border-gray-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:e.jsx(k,{className:"w-7 h-7 text-green-600 dark:text-green-500"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Order History"})]})}),O?e.jsxs("div",{className:"flex flex-col justify-center items-center py-20 text-green-600",children:[e.jsx(v,{className:"w-10 h-10 animate-spin mb-4"}),e.jsx("p",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Loading your orders..."})]}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-50 dark:bg-gray-800 rounded-full flex items-center justify-center mb-6",children:e.jsx(k,{className:"w-12 h-12 text-gray-300 dark:text-gray-600"})}),e.jsx("h4",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"No orders found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-sm",children:"Looks like you haven't placed any orders yet. Start exploring our products!"})]}):e.jsx("div",{className:"grid gap-6",children:b.map(r=>{const m=y.findIndex(t=>t._id&&r._id&&t._id===r._id||t.date&&r.date&&new Date(t.date).getTime()===new Date(r.date).getTime()),s=r.total??r.items?.reduce((t,i)=>t+(i.price??0)*(i.quantity??i.NOI??0),0),n=r._id??m,d=C===n;return e.jsxs("div",{className:"group bg-gray-50 dark:bg-[#252525] border border-gray-200 dark:border-gray-700 rounded-2xl p-6 transition-all duration-300 hover:shadow-md hover:border-green-300 dark:hover:border-green-700/50",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("span",{className:"text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:["Order #",String(n).slice(-6).toUpperCase()]})}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-900 dark:text-white font-semibold",children:[e.jsx(H,{className:"w-4 h-4 text-green-600"}),new Date(r.createdAt||r.date).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-medium mb-1",children:"Total Amount"}),e.jsxs("div",{className:"flex items-center justify-end gap-1 text-2xl font-black text-green-600 dark:text-green-400",children:[e.jsx(F,{className:"w-6 h-6 -mr-1"}),w(s)]})]})]}),e.jsx("div",{className:"bg-white dark:bg-[#1e1e1e] rounded-xl border border-gray-100 dark:border-gray-800 overflow-hidden mb-6",children:e.jsx("ul",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:(r.items||[]).map((t,i)=>{const f=t.quantity??t.NOI??0,q=t.product?.name||t.name||"Unknown Product";return e.jsxs("li",{className:"p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-[#252525] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-2 shrink-0",children:e.jsx(k,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900 dark:text-white line-clamp-1",children:q}),e.jsxs("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:["Qty: ",X(f)]})]})]}),e.jsxs("div",{className:"font-bold text-gray-700 dark:text-gray-300 whitespace-nowrap",children:["$",w(t.price??0)]})]},i)})})}),r.status!=="canceled"&&r.status!=="delivered"&&r._id&&e.jsx("div",{className:"flex justify-end pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("button",{onClick:()=>M(n),disabled:d||_,className:"flex items-center gap-2 px-5 py-2.5 border-2 border-red-200 dark:border-red-900/50 text-red-600 dark:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl font-bold transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:[d?e.jsx(v,{className:"w-5 h-5 animate-spin"}):e.jsx(U,{className:"w-5 h-5"}),d?"Cancelling...":"Cancel Order"]})})]},n)})})]})]})}export{Z as default};
