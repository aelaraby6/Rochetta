import{c as x,q,u as z,p as P,a as $,r as N,j as e,U as D,L as v,t as T,z as o}from"./index-OeRRBTJr.js";import{P as k,D as F}from"./package-DM8BNqjw.js";const E=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],H=x("calendar",E);const J=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],U=x("circle-x",J);const V=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],I=x("log-out",V);const K=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],Q=x("shopping-bag",K),B=q.injectEndpoints({endpoints:t=>({getOrders:t.query({query:()=>"/order",providesTags:["Order"]}),cancelOrder:t.mutation({query:h=>({url:`/order/${h}/cancel`,method:"PATCH"}),invalidatesTags:["Order","Product"]})})}),{useGetOrdersQuery:G,useCancelOrderMutation:R}=B,g=t=>Math.round(Number(t||0)*100)/100,X=t=>Number.isInteger(g(t))?String(g(t)):g(t).toFixed(2),w=t=>g(t).toFixed(2);function Z(){const t=z(),h=P(),{user:s}=$(r=>r.auth),{data:u,isLoading:O,isError:j}=G(void 0,{skip:!s,refetchOnMountOrArgChange:!0}),[S,{isLoading:_}]=R(),[y,c]=N.useState([]),[C,f]=N.useState(null);N.useEffect(()=>{if(!s){t("/login");return}if(u?.orders)c(u.orders);else if(j){console.warn("API failed, using local storage fallback.");const r=`orders_${s.username||s.email}`,m=JSON.parse(localStorage.getItem(r))||[];c(m)}},[u,j,s,t]);const L=()=>{h(T()),t("/login")},M=async r=>{if(!window.confirm("Are you sure you want to cancel this order?"))return;if(f(r),typeof r=="number"||!y.some(d=>d._id===r)){try{const d=`orders_${s?.email||s?.username}`,i=JSON.parse(localStorage.getItem(d))||[],l=Number(r);!Number.isNaN(l)&&l>=0&&l<i.length?(i.splice(l,1),localStorage.setItem(d,JSON.stringify(i)),c([...i]),o.success("Order cancelled successfully")):(c(a=>a.filter((n,b)=>b!==l)),o.success("Order cancelled successfully"))}catch(d){o.error("Failed to cancel local order",d)}finally{f(null)}return}try{await S(r).unwrap(),c(a=>a.filter(n=>n._id!==r));const d=`orders_${s?.email||s?.username}`,l=(JSON.parse(localStorage.getItem(d))||[]).filter(a=>a._id!==r);localStorage.setItem(d,JSON.stringify(l)),o.success("Order cancelled successfully")}catch(d){o.error(d.data?.message||"Failed to cancel order")}finally{f(null)}};if(!s)return null;const p=y.filter(r=>r?.status!=="canceled");return e.jsxs("div",{className:"max-w-6xl mx-auto mt-24 px-4 sm:px-6 lg:px-8 mb-20 w-full transition-colors duration-300",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1e1e1e] rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800 p-8 mb-8 flex flex-col md:flex-row items-center md:items-start justify-between gap-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-green-500/10 rounded-full blur-3xl -z-10 translate-x-1/2 -translate-y-1/2"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6 z-10",children:[e.jsx("div",{className:"w-28 h-28 bg-gradient-to-br from-green-400 to-green-600 text-white rounded-full flex items-center justify-center shadow-lg border-4 border-white dark:border-gray-800 shrink-0",children:e.jsx(D,{className:"w-14 h-14","aria-hidden":"true"})}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-black text-gray-900 dark:text-white mb-1 tracking-tight",children:s.name||s.username||"Valued Customer"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium mb-2",children:s.email}),e.jsxs("div",{className:"inline-flex items-center gap-2 bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full text-sm font-semibold text-gray-700 dark:text-gray-300",children:[e.jsx(Q,{className:"w-4 h-4 text-green-600","aria-hidden":"true"}),p.length," Active Orders"]})]})]}),e.jsxs("button",{onClick:L,className:"z-10 inline-flex items-center gap-2 px-6 py-3 bg-red-50 dark:bg-red-900/20 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/40 rounded-xl font-bold transition-all active:scale-95",children:[e.jsx(I,{className:"w-5 h-5","aria-hidden":"true"}),"Sign Out"]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1e1e1e] rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800 p-6 md:p-10 min-h-[500px]",children:[e.jsx("div",{className:"flex items-center justify-between mb-8 pb-6 border-b border-gray-100 dark:border-gray-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:e.jsx(k,{className:"w-7 h-7 text-green-600 dark:text-green-500","aria-hidden":"true"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Order History"})]})}),O?e.jsxs("div",{className:"flex flex-col justify-center items-center py-20 text-green-600",children:[e.jsx(v,{className:"w-10 h-10 animate-spin mb-4","aria-hidden":"true"}),e.jsx("p",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Loading your orders..."})]}):p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-50 dark:bg-gray-800 rounded-full flex items-center justify-center mb-6",children:e.jsx(k,{className:"w-12 h-12 text-gray-300 dark:text-gray-600","aria-hidden":"true"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"No orders found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-sm",children:"Looks like you haven't placed any orders yet. Start exploring our products!"})]}):e.jsx("div",{className:"grid gap-6",children:p.map(r=>{const m=y.findIndex(a=>a._id&&r._id&&a._id===r._id||a.date&&r.date&&new Date(a.date).getTime()===new Date(r.date).getTime()),d=r.total??r.items?.reduce((a,n)=>a+(n.price??0)*(n.quantity??n.NOI??0),0),i=r._id??m,l=C===i;return e.jsxs("div",{className:"group bg-gray-50 dark:bg-[#252525] border border-gray-200 dark:border-gray-700 rounded-2xl p-6 transition-all duration-300 hover:shadow-md hover:border-green-300 dark:hover:border-green-700/50",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("span",{className:"text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:["Order #",String(i).slice(-6).toUpperCase()]})}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-900 dark:text-white font-semibold",children:[e.jsx(H,{className:"w-4 h-4 text-green-600","aria-hidden":"true"}),new Date(r.createdAt||r.date).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-medium mb-1",children:"Total Amount"}),e.jsxs("div",{className:"flex items-center justify-end gap-1 text-2xl font-black text-green-600 dark:text-green-400",children:[e.jsx(F,{className:"w-6 h-6 -mr-1","aria-hidden":"true"}),w(d)]})]})]}),e.jsx("div",{className:"bg-white dark:bg-[#1e1e1e] rounded-xl border border-gray-100 dark:border-gray-800 overflow-hidden mb-6",children:e.jsx("ul",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:(r.items||[]).map((a,n)=>{const b=a.quantity??a.NOI??0,A=a.product?.name||a.name||"Unknown Product";return e.jsxs("li",{className:"p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-[#252525] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-2 shrink-0",children:e.jsx(k,{className:"w-6 h-6 text-gray-400","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900 dark:text-white line-clamp-1",children:A}),e.jsxs("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:["Qty: ",X(b)]})]})]}),e.jsxs("div",{className:"font-bold text-gray-700 dark:text-gray-300 whitespace-nowrap",children:["$",w(a.price??0)]})]},n)})})}),r.status!=="canceled"&&r.status!=="delivered"&&r._id&&e.jsx("div",{className:"flex justify-end pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("button",{onClick:()=>M(i),disabled:l||_,className:"flex items-center gap-2 px-5 py-2.5 border-2 border-red-200 dark:border-red-900/50 text-red-600 dark:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl font-bold transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:[l?e.jsx(v,{className:"w-5 h-5 animate-spin","aria-hidden":"true"}):e.jsx(U,{className:"w-5 h-5","aria-hidden":"true"}),l?"Cancelling...":"Cancel Order"]})})]},i)})})]})]})}export{Z as default};
